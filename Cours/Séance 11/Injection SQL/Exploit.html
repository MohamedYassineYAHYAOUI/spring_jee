<!DOCTYPE html>
<!-- saved from url=(0058)https://igm.univ-mlv.fr//~carayol/coursJEEM2/tds/td08.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<!-- Required meta tags -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Javascripts --> 
	<script type="text/javascript" src="./Exploit_files/prettify.js.téléchargement"></script>
	<script type="text/javascript" src="./Exploit_files/jquery-3.2.1.slim.min.js.téléchargement"></script>
	<script type="text/javascript" src="./Exploit_files/popper.min.js.téléchargement"></script>
	<script type="text/javascript" src="./Exploit_files/bootstrap.min.js.téléchargement"></script>
	<script type="text/javascript" src="./Exploit_files/hack.js.téléchargement"></script>

	<!-- Bootstrap CSS -->

	<link href="./Exploit_files/bootstrap.css" type="text/css" rel="stylesheet">

   <!-- Syntaxt highlighter CSS -->
   
	<link href="./Exploit_files/prettify.css" type="text/css" rel="stylesheet">

	<!-- Fonts for the icons -->

   <link href="./Exploit_files/fontawesome-all.min.css" rel="stylesheet">

<title>TP Spring Data </title>
  </head>
  <body onload="prettyPrint()">


<!-- Title of the exercice sheet
 
<h1>
		TITLE
		<a href="index.html" style="float:right"><span class="fa fa-home"></span></a>
 </h1>
 -->

<h1>
	Spring MVC
	<a href="https://igm.univ-mlv.fr//~carayol/coursJEEM2/index.html" style="float:right"><span class="fa fa-home"></span></a>
</h1>


   
   
<!-- TABLE OF CONTENT OF THE EXERCICES
 
 <ul class="nav nav-tabs">
 <li class="nav-item">
 <a class="nav-link active" data-toggle="tab" href="#exercice1">Exercice 1</a>
 </li>
 <li class="nav-item">
 <a class="nav-link" data-toggle="tab" href="#exercice2">Exercice 2</a>
 </li>
 </ul>

   -->


<!---

					TABLE OF CONTENT
					
-->

<ul class="nav nav-tabs">
  
<li class="nav-item">
	<a class="nav-link active" data-toggle="tab" href="https://igm.univ-mlv.fr//~carayol/coursJEEM2/tds/td08.html#exercice1">PokeVote   
    </a>
</li>


</ul>

<div id="myTabContent" class="tab-content">

<div class="tab-pane fade show active" id="exercice1">

<!---

                    EXERCICE 1

-->
<h2>Exploit</h2>

<p class="question">Télécharger <a href="https://igm.univ-mlv.fr//~carayol/coursJEEM2/tds/bugged.tgz">bugged.tgz</a></p>

<p>Ce site est un exemple de site vulnérable aux injections JPQL. Après avoir lancé le site, vous pouvez y accéder sur <a href="http://localhost:8080/directory">localhost:8080/directory</a>.
</p>

<p>La vulnérabilité se trouve dans la classe <code>UserService</code>:</p>

<pre class="prettyPrint">@Service
public class UserService {

    @PersistenceContext
    EntityManager em;

    @Transactional
    public List&lt;User&gt; searchByLastName(String lastName) {
        var q = "SELECT s FROM User s WHERE s.lastName = '"+lastName+"'";
        return em.createQuery(q,User.class).getResultList();
    }
}    
</pre>

<p>Cette classe est appelée dans le controlleur:</p>

<pre class="prettyprint prettyprinted" style=""><span class="lit">@Controller</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DirectoryController</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="lit">@Autowired</span><span class="pln">
        </span><span class="typ">UserService</span><span class="pln"> userService</span><span class="pun">;</span><span class="pln">

        </span><span class="lit">@GetMapping</span><span class="pun">(</span><span class="str">"/directory"</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> rectangleForm</span><span class="pun">(){</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"form"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="lit">@PostMapping</span><span class="pun">(</span><span class="str">"/directoryAction"</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> rectangleFormProcess</span><span class="pun">(</span><span class="lit">@ModelAttribute</span><span class="pun">(</span><span class="str">"search"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Search</span><span class="pln"> search</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Model</span><span class="pln"> model</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> answers </span><span class="pun">=</span><span class="pln"> userService</span><span class="pun">.</span><span class="pln">searchByLastName</span><span class="pun">(</span><span class="pln">search</span><span class="pun">.</span><span class="pln">getLastName</span><span class="pun">());</span><span class="pln">
            model</span><span class="pun">.</span><span class="pln">addAttribute</span><span class="pun">(</span><span class="str">"answers"</span><span class="pun">,</span><span class="pln"> answers </span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"results"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">


        </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Search</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">...</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">    </span></pre>

<p class="question">Lancez le site. Votre but est de trouver le numéro de téléphone d'Arnaud Carayol dans ce site (sans regarder dans la base ou dans le fichier <span class="blue"><code>Application.java</code></span>).</p>
</div>



</div> <!-- End of div tab-content -->
      




</body></html>